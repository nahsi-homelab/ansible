base_filesystems:
  - path: "/var/tmp"
    src: "tmpfs"
    opts: "rw,nosuid,noatime,nodev,size=75%,mode=1777"
    fstype: "tmpfs"
    state: "mounted"

  - path: "/tmp"
    src: "tmpfs"
    opts: "rw,nosuid,noatime,nodev,size=2G,mode=1777"
    fstype: "tmpfs"
    state: "mounted"

  - path: "/sys/fs/bpf"
    src: "bpffs"
    fstype: "bpf"
    state: "mounted"

base_network: |
  # pppoe
  config_enp5s0=null
  config_ppp0="ppp"
  link_ppp0="enp5s0"
  plugins_ppp0="pppoe"
  pppd_ppp0="
    noauth
    defaultroute
    mru 1492
    mtu 1492
    lcp-echo-interval 15 lcp-echo-failure 3
    logfile /var/log/pppoe.log
    noaccomp noccp nobsdcomp nodeflate nopcomp novj novjccomp"

  username_ppp0={{ lookup('hashi_vault', 'secret/data/ISP/asia:username') }}
  password_ppp0={{ lookup('hashi_vault', 'secret/data/ISP/asia:password') }}

  rc_net_ppp0_need="net.enp4s0"

  # a workaround for 'WARNING: net.ppp0 has started, but is inactive'
  preup() {
    if [ "${IFACE}" == "ppp0" ]; then
      trap 'mark_service_started' EXIT
    fi
    return 0
  }

  # lan
  config_enp4s0="null"

  vlans_enp4s0="10 30 50"
  config_enp4s0_10="10.2.10.10/24"
  config_enp4s0_30="10.2.30.10/24"
  config_enp4s0_50="10.2.50.10/24"

base_network_interfaces:
  - name: "enp4s0"
  - name: "enp5s0"
    start: false
    enable: false
  - name: "ppp0"

base_packages_pergamon:
  - net-misc/r8125
  - net-dialup/ppp
  - media-plugins/hyperion
  - media-sound/beets
  - sys-power/apcupsd
  - media-tv/v4l-utils
  - media-video/v4l2loopback
  - media-video/obs-studio
  - media-gfx/inkscape
  - media-sound/easyeffects
  - app-emulation/vagrant
  - app-misc/deckmaster
  - media-video/obs-cli
  - app-text/calibre
base_packages: >
  {{
    base_packages_all +
    base_packages_pergamon +
    base_packages_desktop | unique
  }}

base_services:
  - name: "elogind"
    runlevel: "default"
    enabled: true
    state: "started"

  - name: "alsasound"
    runlevel: "default"
    enabled: true
    state: "started"

  - name: "iptables"
    runlevel: "default"
    enabled: true
    state: "started"

base_udev_rules:
  10_streamdeck: |
    SUBSYSTEM=="usb", ATTRS{idVendor}=="0fd9", ATTRS{idProduct}=="0080", MODE:="660", GROUP="usb", SYMLINK+="streamdeck"
  11_moonlander: |
    SUBSYSTEM=="usb", ATTR{idVendor}=="3297", ATTR{idProduct}=="1969", GROUP="plugdev"
