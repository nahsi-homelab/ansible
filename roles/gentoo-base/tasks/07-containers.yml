- name: install podman
  portage:
    package:
      - app-emulation/crun
      - app-emulation/podman

- name: configure podman registries
  template:
    src: "system/podman_registries.conf.j2"
    dest: "/etc/containers/registries.conf"
    owner: root
    group: root
    mode: 0644

- name: configure podman policy
  copy:
    content: "{{ base_podman_policy | to_nice_json(indent=2) }}"
    dest: "/etc/containers/policy.json"
    owner: root
    group: root
    mode: 0644

- name: create containers.conf
  copy:
    content: |
      [engine]
      runtime="crun"
    dest: "/etc/containers/containers.conf"
    owner: root
    group: root
    mode: 0644

- name: enable podman socket api
  service:
    name: podman
    state: started
    enabled: yes
    runlevel: default
    use: openrc

- name: install docker
  portage:
    package:
      - app-emulation/docker

- name: enable docker
  service:
    name: docker
    state: started
    enabled: yes
    runlevel: default
    use: openrc
