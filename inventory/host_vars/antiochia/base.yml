base_filesystems:
  - path: "/var/tmp"
    src: "tmpfs"
    opts: "rw,nosuid,noatime,nodev,size=16G,mode=1777"
    fstype: "tmpfs"
    state: "mounted"

  - path: "/tmp"
    src: "tmpfs"
    opts: "rw,nosuid,noatime,nodev,size=2G,mode=1777"
    fstype: "tmpfs"
    state: "mounted"

  - path: "/sys/fs/bpf"
    src: "bpffs"
    fstype: "bpf"
    state: "mounted"

base_network: |
  config_enp35s0="10.1.10.10/24"
  routes_enp35s0="default via 10.1.10.1"

base_network_interfaces:
  - name: "enp35s0"

base_portage_distcc_cores: 0
base_portage_makeconf_antiochia:
  COMMON_FLAGS: "-O2 -march=znver2 -pipe"
  RUSTFLAGS: "-C target-cpu=znver2"
  CPU_FLAGS_X86: "aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3"
  LUA_TARGETS: "luajit"
  LUA_SINGLE_TARGET: "luajit"
  FEATURES: "parallel-install"
base_portage_makeconf: >
  {{
    base_portage_makeconf_gentoo |
    combine(base_portage_makeconf_antiochia, recursive=true)
  }}

base_portage_package_use_antiochia:
  antiochia: |
   app-emulation/virtualbox -* headless python_single_target_python3_9

base_portage_package_use: >
  {{
    base_portage_package_use_antiochia |
    combine(base_portage_package_use_gentoo, recursive=true)
  }}

base_zfs_datasets:
  - name: "main"
    properties:
      compression: "zstd"
      relatime: "on"
      acltype: "posix"
      xattr: "sa"
      dnodesize: "auto"
      mountpoint: "none"
      canmount: "off"
      normalization: "formD"

  - name: "storage"
    properties:
      compression: "zstd"
      relatime: "on"
      acltype: "posix"
      xattr: "sa"
      dnodesize: "auto"
      mountpoint: "none"
      canmount: "off"
      normalization: "formD"

  - name: "main/system/gentoo"
    properties:
      canmount: "noauto"
      mountpoint: "/"
      org.zfsbootmenu:commandline: "ro quiet loglevel=0"
      org.zfsbootmenu:kernel: "5.10"
    owner: "root"
    group: "root"
    mode: "0755"

  - name: "main/system/opt"
    properties:
      mountpoint: "/opt"
    mode: "0755"

  - name: "main/system/usr/local"
    properties:
      mountpoint: "/usr/local"
    mode: "0755"

  - name: "main/system/var/cache/distfiles"
    properties:
      mountpoint: "/var/cache/distfiles"
    mode: "0775"
    group: "250"

  - name: "main/system/var/db/repos"
    properties:
      mountpoint: "/var/db/repos"
    mode: "0755"

  - name: "main/containers"
    owner: "root"
    group: "root"
    mode: "0710"

  - name: "main/users/home/nahsi" # TODO: change to users/nahsi/home
    properties:
      mountpoint: "/home/nahsi"
      compression: "zstd"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "main/users/nahsi/downloads/incomplete"
    properties:
      mountpoint: "/home/nahsi/downloads/incomplete"
      compression: "off"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "storage/users/nahsi/downloads/complete"
    properties:
      mountpoint: "/home/nahsi/downloads/complete"
      compression: "zstd"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "storage/users/nahsi/media/video"
    properties:
      mountpoint: "/home/nahsi/media/video"
      compression: "off"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "storage/users/nahsi/media/audio"
    properties:
      mountpoint: "/home/nahsi/media/audio"
      compression: "off"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "storage/users/nahsi/media/music"
    properties:
      mountpoint: "/home/nahsi/media/music"
      compression: "off"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "storage/users/nahsi/storage"
    properties:
      mountpoint: "/home/nahsi/storage"
      compression: "zstd"
    owner: "33"
    group: "33"
    mode: "0755"

  - name: "storage/users/nahsi/unsorted"
    properties:
      mountpoint: "/home/nahsi/unsorted"
      compression: "zstd"
    owner: "nahsi"
    group: "nahsi"
    mode: "0755"

  - name: "main/users/taisto/home"
    properties:
      mountpoint: "/home/taisto"
      compression: "zstd"
      quota: "50G"
    owner: "taisto"
    group: "taisto"
    mode: "0755"

  - name: "main/users/taisto/downloads/incomplete"
    properties:
      mountpoint: "/home/taisto/downloads/incomplete"
      compression: "off"
      quota: "200G"
    owner: "taisto"
    group: "taisto"
    mode: "0755"

  - name: "storage/users/taisto/downloads/complete"
    properties:
      mountpoint: "/home/taisto/downloads/complete"
      compression: "zstd"
      quota: "500G"
    owner: "taisto"
    group: "taisto"
    mode: "0755"

  - name: "storage/users/taisto/media/video"
    properties:
      mountpoint: "/home/taisto/media/video"
      compression: "off"
      quota: "2T"
    owner: "taisto"
    group: "taisto"
    mode: "0755"

  - name: "storage/users/taisto/storage"
    properties:
      mountpoint: "/home/taisto/storage"
      compression: "zstd"
      quota: "1T"
    owner: "33"
    group: "33"
    mode: "0755"

  - name: "main/data/polaris"
    properties:
      atime: "off"
      compression: "lz4"
      mountpoint: "/var/lib/polaris"
    owner: "100"
    group: "100"
    mode: "0700"

  - name: "main/data/jellyfin"
    properties:
      atime: "off"
      mountpoint: "/var/lib/jellyfin"
      compression: "lz4"
    owner: "nobody"
    group: "nobody"
    mode: "0750"

  - name: "main/data/filerun"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/filerun"
    owner: "33"
    group: "33"
    mode: "0700"

  - name: "main/data/transmission-nahsi"
    properties:
      atime: "off"
      mountpoint: "/var/lib/transmission-nahsi"
    owner: "1000"
    group: "1000"
    mode: "0750"

  - name: "main/data/transmission-taisto"
    properties:
      atime: "off"
      mountpoint: "/var/lib/transmission-taisto"
    owner: "1001"
    group: "1001"
    mode: "0750"

  - name: "main/data/kafka"
    properties:
      atime: "off"
      mountpoint: "/var/lib/kafka"
    owner: "1001"
    group: "1001"
    mode: "0700"

  - name: "main/data/minio"
    properties:
      atime: "off"
      mountpoint: "/var/lib/minio"
      quota: "50G"
    owner: "nobody"
    group: "nobody"
    mode: "0700"

  - name: "main/data/mongo"
    properties:
      atime: "off"
      compression: "zstd"
      logbias: "throughput"
      primarycache: "metadata"
      mountpoint: "/var/lib/mongo"
      quota: "100G"
    owner: "999"
    group: "999"
    mode: "0700"

  - name: "main/data/filestash"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/filestash"
      quota: "10G"
    owner: "1000"
    group: "1000"
    mode: "0700"

  - name: "main/data/postgres"
    properties:
      atime: "off"
      compression: "lz4"
      logbias: "throughput"
      primarycache: "metadata"
      recordsize: "8k"
      mountpoint: "/var/lib/postgres"
    owner: "999"
    group: "999"
    mode: "0700"

  - name: "main/data/mariadb"
    properties:
      atime: "off"
      compression: "lz4"
      logbias: "throughput"
      primarycache: "metadata"
      recordsize: "16k"
      mountpoint: "/var/lib/mariadb"
    owner: "999"
    group: "999"
    mode: "0700"

  - name: "main/data/redis-mail"
    properties:
      atime: "off"
      mountpoint: "/var/lib/redis-mail"
      quota: "1G"
    owner: "nobody"
    group: "nobody"

  - name: "main/data/victoria-metrics"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/victoria-metrics"
      quota: "50G"
    owner: "nobody"
    group: "nobody"
    mode: "0750"

  - name: "main/data/nats"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/nats"
      quota: "10G"
    mode: "0750"

  - name: "main/data/seaweedfs-master"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/seaweedfs-master"
      quota: "1G"
    mode: "0700"
    owner: "nobody"
    group: "nobody"
    absent: true

  - name: "main/data/seaweedfs-index"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/seaweedfs-index"
      quota: "10G"
    mode: "0700"
    owner: "nobody"
    group: "nobody"

  - name: "main/data/seaweedfs-ssd"
    properties:
      atime: "off"
      compression: "zstd"
      mountpoint: "/var/lib/seaweedfs-ssd"
      quota: "200G"
    mode: "0700"
    owner: "nobody"
    group: "nobody"

  - name: "main/data/unifi"
    properties:
      atime: "off"
      mountpoint: "/var/lib/unifi"
      compression: "lz4"
    owner: "1000"
    group: "1000"
    mode: "0750"
