vault_download_url: "https://releases.hashicorp.com"

vault_configs: {}

vault_dir: "/opt/vault"
vault_dirs_base:
  main:
    path: "{{ vault_dir }}"
  configs:
    path: "{{ vault_dir }}/config.d"
  certs:
    path: "{{ vault_dir }}/certs"
  data:
    path: "/var/lib/vault"
    mode: "u=rwX,g=rX,o="
vault_dirs_overlay: {}
vault_dirs: >
  {{
    vault_dirs_base |
    combine(vault_dirs_overlay, recursive=true)
  }}

vault_service: |
  #!/sbin/openrc-run

  description="HashiCorp Vault"
  extra_started_commands="reload"
  group="${RC_SVCNAME}"
  user="${RC_SVCNAME}"
  pidfile="/run/${RC_SVCNAME}.pid"

  command="/usr/bin/${RC_SVCNAME}"
  command_args="server -config={{ vault_dir }}/vault.json -config={{ vault_dirs.configs.path }}"
  command_background="true"
  start_stop_daemon_args="--user ${user} --group ${group}"

  depend() {
      need net
  }

  reload() {
      ebegin "Reloading vault"
      ${command} reload
      eend $?
  }
