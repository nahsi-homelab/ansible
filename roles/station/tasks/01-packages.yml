- name: set useflags
  tags: packages
  copy:
    content: "{{ station_useflags }}"
    dest: "/etc/portage/package.use/station-default.use"
    owner: root
    group: root
    mode: 0644
  notify: update use
  vars:
    station_useflags: |
      media-video/ffmpeg chromium libdrm x264 x265 webp vpx vorbis theora
      media-gfx/imagemagick -X
      media-fonts/noto cjk

      media-video/pipewire pipewire-alsa extra

      app-emulation/virtualbox -* headless python_single_target_python3_9
      app-emulation/qemu spice gtk

      # jellyfin mpv shim
      media-tv/jellyfin-mpv-shim shaders
      media-video/mpv libmpv

      # theme
      dev-qt/qtgui dbus
      x11-themes/arc-theme gtk3

      # gnupg
      app-crypt/pinentry gtk
      app-crypt/gcr gtk

      # ansible
      net-libs/zeromq drafts
      dev-lang/python sqlite

      # qutebrowser
      www-client/qutebrowser scripts
      dev-python/PyQt5 declarative printsupport widgets gui network opengl sql multimedia webchannel websockets dbus svg
      dev-libs/libpcre2 pcre16
      sys-libs/zlib minizip
      dev-qt/qtmultimedia widgets
      dev-qt/qtwebengine widgets
      dev-qt/qtwebchannel qml
      media-libs/libvpx svc

      # xdg-utils
      app-text/xmlto text

- name: install pipewire
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-video/pipewire

- name: install awesome-wm and dependencies
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - x11-base/xorg-server
      - x11-wm/awesome
      - x11-libs/lain

- name: enable elogind
  tags: packages
  service:
    name: "elogind"
    enabled: yes
    runlevel: "boot"
    use: openrc

- name: install gnupg and pass
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-crypt/gnupg
      - app-crypt/pinentry
      - app-admin/pass

- name: install mpv and ffmpeg
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-video/ffmpeg
      - media-video/mpv
      - media-video/mediainfo
      - media-tv/jellyfin-mpv-shim

- name: install virtualization packages
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-emulation/virtualbox
      - app-emulation/qemu
      - app-emulation/docker-compose

- name: install tools and other packages
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - x11-terms/kitty
      - app-misc/tmux
      - app-misc/smug
      - x11-misc/redshift
      - x11-misc/rofi
      - sys-apps/bat
      - app-misc/task
      - x11-misc/picom
      - media-gfx/maim
      - app-misc/anki
      - x11-apps/xrandr
      - x11-misc/xdg-utils
      - app-admin/chezmoi
      - net-misc/youtube-dl
      - x11-misc/unclutter
      - dev-qt/qtstyleplugins
      - x11-misc/qt5ct
      - x11-themes/papirus-icon-theme
      - x11-themes/arc-theme
      - x11-themes/adwaita-qt
      - media-video/pipewire

- name: install fonts
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-fonts/fira-sans
      - media-fonts/fira-mono
      - media-fonts/fira-code
      - media-fonts/noto
      - media-fonts/noto-emoji
      - media-fonts/roboto

- name: install qutebrowser
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - www-client/qutebrowser
      - dev-python/tldextract  # for qute-pass

- name: install messengers
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - net-im/telegram-desktop-bin
      - net-im/slack
      - net-im/zoom

- name: install python packages
  tags: packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-admin/ansible
      - app-admin/ansible-lint
      - app-admin/ansible-modules-hashivault
      - dev-python/hvac
      - dev-python/virtualenv
      - dev-python/pip
      - dev-python/jmespath

- name: install packages
  tags: packages
  portage:
    package: "{{ item }}"
    state: present
  loop: "{{ station_packages }}"
  when: station_packages is defined
