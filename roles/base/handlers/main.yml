- name: update use
  portage:
    package: "@world"
    deep: yes
    newuse: yes
    changed_use: yes

- name: generate locales
  command: locale-gen --update

- name: update env
  command: env-update

- name: set timezone
  command: emerge --config sys-libs/timezone-data

- name: run resolvconf
  command: resolvconf -u

- name: restart network
  service:
    name: "net.{{ item.name }}"
    state: restarted
    use: openrc
  loop: "{{ base_network_interfaces }}"
  loop_control:
    label: "{{ item.name }}"
  when:
    - not chroot
    - item.start | default(true)

- name: restart wireguard
  service:
    name: "wg.{{ item.name }}"
    state: restarted
    use: openrc
  loop: "{{ base_wireguard_interfaces }}"
  loop_control:
    label: "{{ item.name }}"
  when:
    - not chroot
    - item.start | default(true)

- name: reload syslog
  service:
    name: syslog-ng
    state: reloaded
    use: openrc
  when:
    - not chroot

- name: restart iwd
  service:
    name: iwd
    state: restart
    use: openrc
  when:
    - not chroot

- name: restart sshd
  service:
    name: sshd
    state: restarted
    use: openrc
  when:
    - not chroot

- name: restart podman
  service:
    name: podman
    state: restarted
    use: openrc
  when:
    - not chroot

- name: restart docker
  service:
    name: docker
    state: restarted
    use: openrc
  when:
    - not chroot
