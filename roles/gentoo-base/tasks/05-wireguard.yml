- name: install wireguard-tools
  portage:
    package: "net-vpn/wireguard-tools"

- name: create wireguard directory
  file:
    path: "/etc/wireguard"
    state: directory
    owner: root
    group: root
    mode: 0700

- name: copy wireguard configurations
  no_log: true
  copy:
    content: "{{ config.value }}"
    dest: "/etc/wireguard/{{ config.key }}.conf"
    owner: root
    group: root
    mode: 0600
  loop: "{{ base_wireguard_configs | dict2items }}"
  loop_control:
    loop_var: "config"
  notify: restart network
