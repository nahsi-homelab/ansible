- hosts: "{{ target }}"
  become: yes
  become_method: doas
  vars:
    suckless:
      - media-gfx/sxiv
      - x11-terms/st
      - x11-misc/dmenu
  tasks:
    - name: create suckless savedconfig directories
      file:
        path: "/etc/portage/savedconfig/{{ item | dirname }}"
        state: directory
        mode: 0755
      loop: "{{ suckless }}"

    - name: copy suckless configs
      copy:
        src: "files/{{ item }}"
        dest: "/etc/portage/savedconfig/{{ item }}"
      loop: "{{ suckless }}"

    - name: set packages use flags
      copy:
        content: |
          media-gfx/sxiv gif savedconfig
          x11-terms/st savedconfig
          x11-misc/dmenu savedconfig
        dest: /etc/portage/package.use/suckless.use
        mode: 0644

    - name: emerge suckless
      portage:
        package: "{{ item }}"
      loop: "{{ suckless }}"


