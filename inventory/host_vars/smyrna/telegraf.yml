telegraf_configs_smyrna:
  sensors: |
    [[inputs.sensors]]

  zfs: |
    [[inputs.zfs]]
      kstatMetrics = ["arcstats", "zil"]
    [[inputs.execd]]
      command = ["/usr/libexec/zfs/zpool_influxdb", "--execd"]
      signal = "STDIN"
      restart_delay = "10s"
      data_format = "influx"

  apcupsd: |
    [[inputs.apcupsd]]
      # A list of running apcupsd server to connect to.
      # If not provided will default to tcp://127.0.0.1:3551
      servers = ["tcp://{{ private_ip }}:3551"]

      ## Timeout for dialing server.
      timeout = "5s"

    [[processors.regex]]
      namepass = ["apcupsd*"]
      [[processors.regex.tags]]
        key = "ups_name"
        pattern = ".*"
        replacement = "{{ dc }}"

telegraf_configs: >
  {{
    telegraf_configs_all |
    combine(telegraf_configs_smyrna, recursive=true)
  }}
