base_portage_makeconf_pergamon:
  COMMON_FLAGS: "-O2 -march=broadwell -pipe"
  RUSTFLAGS: "-C target-cpu=broadwell"
  CPU_FLAGS_X86: "aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3 rdrand"
  VIDEO_CARDS: "intel i965 iris"
  LUA_TARGETS: "luajit"
  LUA_SINGLE_TARGET: "luajit"
  LLVM_TARGETS: "X86"
  DISTCC_HOSTS: "antiochia.node.consul/16 pergamon.node.consul/32"
  FEATURES: "parallel-install distcc"
  INPUT_DEVICES: "synaptics evdev"
  ACCEPT_LICENSE: "* -@EULA google-chrome"
base_portage_makeconf: >
  {{
    base_portage_makeconf_all |
    combine(base_portage_makeconf_pergamon, recursive=true)
  }}

base_portage_env:
  notmpfs: |
    PORTAGE_TMPDIR="/var/notmpfs"
    COMMON_FLAGS="$COMMON_FLAGS -pipe"

base_portage_package_env:
  chromium: |
    www-client/chromium base-notmpfs
  qtwebengine: |
    dev-qt/qtwebengine base-notmpfs

base_portage_package_use_miletos:
  system: |
    media-libs/mesa -gles2

base_portage_package_use: >
  {{
    base_portage_package_use_miletos |
    combine(base_portage_package_use_desktop, recursive=true) |
    combine(base_portage_package_use_all, recursive=true)
  }}

base_portage_use:
  - zstd
  - luajit
  - dist-kernel
  - X
  - elogind
  - cups
  - -policykit
  - dri
  - drm
  - icu
  - xcb
  - -gtk
  - -gtk3
  - -sound
  - alsa
  - pipewire

  - vulkan
  - opengl
  - vaapi

  - opus
  - ogg
  - vorbis
  - flac
  - gif
  - jpeg
  - png
  - webp
  - dts
