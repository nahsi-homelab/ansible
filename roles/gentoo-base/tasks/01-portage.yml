- name: create portage directories
  tags: portage
  file:
    dest: "{{ item }}"
    state: directory
    owner: root
    group: root
    mode: 0755
  loop:
    - /etc/portage/package.use
    - /etc/portage/package.mask
    - /etc/portage/package.accept_keywords
    - /etc/portage/repos.conf
    - /etc/portage/savedconfig
    - /etc/portage/env
    - /etc/portage/patches

- name: copy make.conf
  tags: portage
  copy:
    content: |
      {% for key, value in base_portage_makeconf.items() %}
      {{ key }}="{{ value }}"
      {% endfor %}
    dest: /etc/portage/make.conf
    owner: root
    group: root
    mode: 0644
  notify: update use

- name: set packages use flags
  tags: portage
  copy:
    content: |
      {% for key, value in base_portage_package_use.items() %}
      {{ key }} {{ value }}
      {% endfor %}
    dest: /etc/portage/package.use/base.use
    owner: root
    group: root
    mode: 0644
  notify: update use

- name: install distcc
  portage:
    package: sys-devel/distcc
    state: present
