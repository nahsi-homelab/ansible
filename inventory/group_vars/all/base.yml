# /usr/share/zoneinfo
base_timezone: "Europe/Moscow"
# /usr/share/consolefonts
base_consolefont: "ter-i16b"

base_hosts: |
  127.0.0.1 {{ inventory_hostname }}.{{ dc }} {{ inventory_hostname }} localhost
  ::1       {{ inventory_hostname }}.{{ dc }} {{ inventory_hostname }} localhost

# List of locales to generate
base_locales:
  - "en_US.UTF-8 UTF-8"

# Variables to set with eselect
base_eselect:
  - module: locale
    target: "en_US.UTF-8"
  - module: editor
    target: "nvim"

base_hwclock: |
  # Is your hardware clock set to local or to UTC?
  # If you dualboot with Windows set to "local"
  clock_local="utc"
  # Set the hardware clock to the current systemtime during shutdown
  clock_systohc="YES"
  # Set systemtime to current hardware clock durning boot
  clock_hctosys="YES"
  clock_args=""

# https://github.com/OpenRC/openrc/blob/master/etc/rc.conf
# https://wiki.gentoo.org/wiki/OpenRC
base_openrc: |
  # Enable logging
  rc_logger="YES"
  rc_log_path="/var/log/rc.log"
  # Number of ttys allocated for logins
  rc_tty_number=2

base_doas_conf: >
  permit nopass :wheel

base_packages_all:
  - app-admin/doas
  - sys-devel/distcc
  - dev-vcs/git
  - sys-process/cronie
  - app-eselect/eselect-repository
  - sys-fs/dosfstools
  - net-firewall/iptables
  - app-arch/p7zip
  - media-fonts/terminus-font
  - app-shells/bash-completion
  - app-shells/gentoo-bashcomp
  - sys-apps/gptfdisk
  - app-misc/ca-certificates
  - net-proxy/shadowsocks-libev

  # github-runner dependencies
  - dev-libs/icu
  - dev-util/lttng-ust
  - sys-libs/zlib
  - dev-libs/openssl
  - net-dns/libidn
  - net-libs/nghttp2
  - dev-dotnet/dotnet-sdk-bin

  - app-emulation/qemu
  - app-containers/crun
  - app-containers/docker
  - app-containers/podman
  - app-emulation/virtualbox

  - dev-python/docker-py

  - app-portage/portage-utils
  - app-portage/flaggie
  - app-portage/cpuid2cpuflags
  - app-misc/resolve-march-native
  - app-portage/repoman
  - app-portage/genlop

  - sys-apps/usbutils
  - sys-apps/lshw
  - net-dns/bind-tools
  - net-analyzer/traceroute
  - net-analyzer/tcpdump
  - net-analyzer/arp-scan
  - net-misc/iperf
  - net-analyzer/openbsd-netcat
  - sys-apps/dmidecode

  - sys-power/cpupower
  - sys-apps/lm-sensors
  - sys-apps/smartmontools

  - sys-process/iotop-c
  - sys-process/htop
  - sys-process/lsof
  - sys-fs/ncdu

  - app-editors/neovim
  - dev-python/pynvim
  - app-text/tree
  - app-misc/nnn
  - app-misc/jq
  - app-admin/pwgen
base_packages: "{{ base_packages_all }}"

base_sshd_config: |
  Protocol 2
  KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256
  Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr
  MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com
  PermitRootLogin no
  PubkeyAuthentication yes
  HostbasedAuthentication no
  PasswordAuthentication no
  PermitEmptyPasswords no
  SyslogFacility AUTH
  LogLevel INFO
  AllowGroups wheel
  HostKey /etc/ssh/ssh_host_rsa_key
  HostKey /etc/ssh/ssh_host_ed25519_key
  {% if base_sshd_listen is defined %}
  {% for addr in base_sshd_listen %}
  ListenAddress {{ addr }}
  {% endfor %}
  {% endif %}

  Subsystem sftp internal-sftp

base_users:
  - name: nahsi
    groups:
      - wheel
      - portage
      - docker
    append: true
    ssh: https://github.com/nahsi.keys
    password: "bd7465fc49ba157a92c751e33c3de9030a5d303e917daeab49cd76ba8f1409abe573286925f1127fea19932c1292867d4eaead98aacbb0969a83a8f75fbe7181"

  - name: github
    comment: "GitHub actions runner user"
    create_home: false
    system: true
    groups:
      - docker
      - vboxusers
    append: true
    uid: 950
