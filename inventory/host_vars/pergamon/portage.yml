base_portage_distcc_cores: 0
base_portage_makeconf_pergamon:
  COMMON_FLAGS: "-O2 -march=znver3"
  RUSTFLAGS: "-C target-cpu=znver3"
  CPU_FLAGS_X86: "aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3"
  VIDEO_CARDS: "amdgpu radeonsi"
  INPUT_DEVICES: "evdev"
  LUA_TARGETS: "luajit"
  LUA_SINGLE_TARGET: "luajit"
  LLVM_TARGETS: "AMDGPU X86"
  FEATURES: "parallel-install"
  ACCEPT_LICENSE: "* -@EULA google-chrome"
base_portage_makeconf: >
  {{
    base_portage_makeconf_all |
    combine(base_portage_makeconf_pergamon, recursive=true)
  }}

base_portage_package_use_pergamon:
  system: |
    media-libs/mesa -classic -gles2

  pergamon: |
    media-plugins/hyperion -v4l -qt-grabber -zeroconf

    media-tv/v4l-utils qt5 -bpf
    media-video/obs-studio truetype v4l

    app-text/poppler cairo

    # audio
    media-video/pipewire pipewire-alsa extra gstreamer jack-sdk
    media-libs/portaudio jack
    media-sound/easyeffects -doc calf mda-lv2 zamaudio
    media-libs/rubberband ladspa
    media-plugins/calf lv2

    # xorg-server
    x11-libs/libdrm video_cards_radeon

    # messengers
    app-text/ghostscript-gpl cups

    # calibre
    app-text/poppler qt5
    app-accessibility/speech-dispatcher python
    app-text/podofo lua_single_target_lua5-4
    app-text/calibre -udisks

base_portage_package_use: >
  {{
    base_portage_package_use_pergamon |
    combine(base_portage_package_use_desktop, recursive=true) |
    combine(base_portage_package_use_all, recursive=true)
  }}

base_portage_use:
  - zstd
  - luajit
  - dist-kernel
  - X
  - elogind
  - -policykit
  - -geolocation
  - dri
  - drm
  - icu
  - xcb
  - -gtk
  - -gtk3
  - -sound
  - alsa
  - pipewire

  - vulkan
  - vaapi
  - vdpau
  - opengl

  - opus
  - ogg
  - vorbis
  - flac
  - gif
  - jpeg
  - png
  - webp
  - dts

base_portage_env:
  cc1plus: |
    EMERGE_DEFAULT_OPTS="--jobs=8 --load-average={{ base_portage_la }} --quiet-build"
    MAKEOPTS="--jobs=8 --load-average={{ base_portage_la }}"

base_portage_package_env:
  cc1plus: |
    www-client/chromium base-cc1plus.conf
    dev-qt/qtwebengine base-cc1plus.conf
    net-im/telegram-desktop base-cc1plus.conf
    media-gfx/inkscape base-cc1plus.conf
