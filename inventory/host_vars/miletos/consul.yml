consul_service: |
  #!/sbin/openrc-run

  description="HashiCorp Consul - A service service mesh solution"

  user="{{ consul_user }}"
  group="{{ consul_group }}"

  rc_ulimit="-n 65536"

  supervisor="supervise-daemon"
  pidfile="/run/${RC_SVCNAME}.pid"
  command="/usr/bin/${RC_SVCNAME}"
  command_args="agent -config-file {{ consul_dirs.main.path }}/consul.json -config-dir={{ consul_dirs.configs.path }} -config-dir={{ consul_dirs.services.path }}"
  command_background="true"
  extra_started_commands="reload"

  depend() {
      need net
      after docker
      after wg.relay
  }

  reload() {
      ebegin "Reloading consul"
      ${command} reload
      eend $?
  }
