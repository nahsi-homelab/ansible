- name: set useflags
  tags: packages
  copy:
    content: "{{ station_useflags }}"
    dest: "/etc/portage/package.use/station-default.use"
    owner: root
    group: root
    mode: 0644
  notify: update use
  vars:
    station_useflags: |
      media-video/ffmpeg chromium libdrm x264 x265 webp vpx vorbis theora
      media-gfx/imagemagick -X
      media-fonts/noto cjk
      app-emulation/virtualbox headless -alsa -qt5 -sdk -udev -opengl -opus

      # gnupg
      app-crypt/pinentry gtk
      app-crypt/gcr gtk

      # ansible
      net-libs/zeromq drafts
      dev-lang/python sqlite

      # qutebrowser
      www-client/qutebrowser scripts
      dev-python/PyQt5 declarative printsupport widgets gui network opengl sql multimedia webchannel websockets dbus svg
      dev-libs/libpcre2 pcre16
      sys-libs/zlib minizip
      dev-qt/qtmultimedia widgets
      dev-qt/qtwebengine widgets
      dev-qt/qtwebchannel qml
      media-libs/libvpx svc

- name: install awesome-wm and dependencies
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - x11-base/xorg-server
      - x11-apps/xrandr
      - x11-wm/awesome

- name: install alsa and apulse
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-sound/alsa-utils
      - media-sound/apulse

- name: install gnupg and pass
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-crypt/gnupg
      - app-crypt/pinentry
      - app-admin/pass

- name: install mpv and ffmpeg
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-video/ffmpeg
      - media-video/mpv
      - media-video/mediainfo

- name: install virtualization packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-emulation/virtualbox
      - app-emulation/docker-compose

- name: install tools and other packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - x11-terms/kitty
      - app-misc/tmux
      - app-misc/smug
      - x11-misc/redshift
      - x11-misc/rofi
      - sys-apps/bat
      - app-misc/task
      - x11-misc/picom
      - media-gfx/maim
      - x11-themes/papirus-icon-theme

- name: install fonts
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - media-fonts/fira-sans
      - media-fonts/fira-mono
      - media-fonts/fira-code
      - media-fonts/noto
      - media-fonts/noto-emoji
      - media-fonts/roboto

- name: install qutebrowser
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - www-client/qutebrowser
      - dev-python/tldextract  # for qute-pass

- name: install python packages
  portage:
    package: "{{ packages }}"
    state: present
  vars:
    packages:
      - app-admin/ansible
      - app-admin/ansible-lint
      - app-admin/ansible-modules-hashivault
      - dev-python/hvac
      - dev-python/virtualenv
      - dev-python/pip
      - dev-python/jmespath

- name: install packages
  tags: packages
  portage:
    package: "{{ item }}"
    state: present
  loop: "{{ station_packages }}"
  when: station_packages is defined
