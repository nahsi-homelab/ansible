base_consolefont: "ter-i24b"

base_filesystems:
  - path: "/tmp"
    src: "tmpfs"
    opts: "rw,nosuid,noatime,nodev,size=1G,mode=1777"
    type: "tmpfs"

base_sysctl:
  - name: net.ipv4.ip_forward
    value: 1
  - name: net.ipv4.conf.default.rp_filter
    value: 1

base_sshd_openrc_config: |
  SSHD_CONFDIR="${RC_PREFIX%/}/etc/ssh"
  SSHD_OPTS=""
  rc_need="net.enp2s0"

base_services:
  - name: "docker"
    runlevel: "default"
    enabled: true
    state: "started"
  - name: "iptables"
    runlevel: "default"
    enabled: true
    state: "started"
  - name: "tailscale"
    runlevel: "default"
    enabled: true
    state: "started"

base_packages_tyros:
  - net-dialup/ppp
  - sys-power/apcupsd
base_packages: "{{ base_packages_all + base_packages_tyros | unique }}"

base_network_interfaces:
  - name: "enp2s0"
  - name: "enp3s0"
    start: false
    enable: false
  - name: "ppp0"

base_network: |
  # pppoe
  config_enp3s0=null
  vlans_enp3s0="3005"
  config_enp3s0_3005=null

  config_ppp0="ppp"
  link_ppp0="enp3s0.3005"
  plugins_ppp0="pppoe"
  pppd_ppp0="
    noauth
    defaultroute
    mru 1492
    mtu 1492
    lcp-echo-interval 15 lcp-echo-failure 3
    noaccomp noccp nobsdcomp nodeflate nopcomp novj novjccomp"

  username_ppp0={{ lookup('hashi_vault', 'secret/data/ISP/syria:username') }}
  password_ppp0={{ lookup('hashi_vault', 'secret/data/ISP/syria:password') }}

  rc_net_ppp0_need="net.enp3s0"

  # a workaround for 'WARNING: net.ppp0 has started, but is inactive'
  preup() {
    if [ "${IFACE}" == "ppp0" ]; then
      trap 'mark_service_started' EXIT
    fi
    return 0
  }

  # lan
  config_enp2s0=null

  vlans_enp2s0="10 30 50"
  config_enp2s0_10="192.168.110.1/24"
  config_enp2s0_30="192.168.130.1/24"
  config_enp2s0_50="192.168.150.1/24"
