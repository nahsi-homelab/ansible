base_portage_makeconf_pergamon:
  COMMON_FLAGS: "-O2 -march=amdfam10 -mcx16 -mpopcnt"
  RUSTFLAGS: "-C target-cpu=amdfam10"
  CPU_FLAGS_X86: "3dnow 3dnowext popcnt mmx mmxext sse sse2 sse3 sse4a"
  VIDEO_CARDS: "amdgpu radeonsi"
  INPUT_DEVICES: "evdev"
  LUA_TARGETS: "luajit"
  LUA_SINGLE_TARGET: "luajit"
  LLVM_TARGETS: "AMDGPU X86"
  DISTCC_HOSTS: "antiochia.node.syria.consul/16"
  FEATURES: "parallel-install distcc"
base_portage_makeconf: >
  {{
    base_portage_makeconf_all |
    combine(base_portage_makeconf_pergamon, recursive=true)
  }}

base_portage_package_use_pergamon:
  system: |
    net_misc/openssh -pam
    sys-devel/gcc pgo
    dev-lang/rust clippy rls rustfmt
    media-libs/mesa -classic -gles2

  pergamon: |
    media-plugins/hyperion -v4l -qt-grabber -zeroconf

    # xorg-server
    x11-libs/libdrm video_cards_radeon

    # messengers
    app-text/ghostscript-gpl cups

base_portage_package_use: >
  {{
    base_portage_package_use_pergamon |
    combine(base_portage_package_use_desktop, recursive=true)
  }}

base_portage_use:
  - zstd
  - luajit
  - dist-kernel
  - X
  - elogind
  - -policykit
  - dri
  - drm
  - icu
  - xcb
  - -gtk
  - -gtk3
  - -sound
  - alsa
  - pipewire

  - vulkan
  - vaapi
  - vdpau
  - opengl

  - opus
  - ogg
  - vorbis
  - flac
  - gif
  - jpeg
  - png
  - webp
  - dts
